<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Tally System</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.8.1/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gray-100 p-4">
    <div x-data="tallyApp()" class="max-w-xl mx-auto bg-white p-4 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold mb-4">Real-Time Tally System</h1>
        <div class="mb-4">
            <input x-model="newTally.name" type="text" placeholder="Tally Name" class="border p-2 rounded w-full mb-2">
            <input x-model="newTally.color" type="color" class="w-full mb-2">
            <button @click="createTally" class="bg-blue-500 text-white px-4 py-2 rounded">Create Tally</button>
        </div>
        <div id="tallies" class="space-y-2">
            <template x-for="tally in tallies" :key="tally.id">
                <div :style="{ backgroundColor: tally.color }" class="flex justify-between items-center p-2 border rounded">
                    <div class="font-bold" x-text="tally.name"></div>
                    <div class="text-xl" x-text="tally.count"></div>
                    <button @click="increment(tally)" class="bg-green-500 text-white px-2 py-1 rounded">+</button>
                    <button @click="decrement(tally)" class="bg-red-500 text-white px-2 py-1 rounded ml-2">-</button>
                </div>
            </template>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBXyC75w0YvkOzr-Q71FcooE3juqtb-ZwE",
            authDomain: "counterthing-70f96.firebaseapp.com",
            projectId: "counterthing-70f96",
            storageBucket: "counterthing-70f96.appspot.com",
            messagingSenderId: "934844864719",
            appId: "1:934844864719:web:85c9ad24529c3d204e7fba"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.tallyApp = function() {
            return {
                tallies: [],
                newTally: {
                    name: '',
                    color: '#ffffff'
                },
                async init() {
                    onSnapshot(collection(db, "tallies"), (snapshot) => {
                        this.tallies = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    });
                },
                async createTally() {
                    if (this.newTally.name) {
                        await addDoc(collection(db, "tallies"), {
                            name: this.newTally.name,
                            color: this.newTally.color,
                            count: 0
                        });
                        this.newTally.name = '';
                        this.newTally.color = '#ffffff';
                    }
                },
                async increment(tally) {
                    await updateDoc(doc(db, "tallies", tally.id), {
                        count: tally.count + 1
                    });
                },
                async decrement(tally) {
                    if (confirm("Are you sure you want to decrease the count?")) {
                        await updateDoc(doc(db, "tallies", tally.id), {
                            count: tally.count - 1
                        });
                    }
                }
            };
        }
    </script>
</body>
</html>
