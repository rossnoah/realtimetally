<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Tally System</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-xl mx-auto bg-white p-4 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold mb-4">Real-Time Tally System</h1>
        <div class="mb-4">
            <input id="tallyName" type="text" placeholder="Tally Name" class="border p-2 rounded w-full mb-2">
            <input id="tallyColor" type="color" class="w-full mb-2">
            <button id="createTally" class="bg-blue-500 text-white px-4 py-2 rounded">Create Tally</button>
        </div>
        <div id="tallies" class="space-y-2"></div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBXyC75w0YvkOzr-Q71FcooE3juqtb-ZwE",
            authDomain: "counterthing-70f96.firebaseapp.com",
            projectId: "counterthing-70f96",
            storageBucket: "counterthing-70f96.appspot.com",
            messagingSenderId: "934844864719",
            appId: "1:934844864719:web:85c9ad24529c3d204e7fba"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const tallyCollection = collection(db, "tallies");

        document.getElementById("createTally").addEventListener("click", async () => {
            const name = document.getElementById("tallyName").value;
            const color = document.getElementById("tallyColor").value;
            if (name) {
                await addDoc(tallyCollection, {
                    name: name,
                    color: color,
                    count: 0
                });
                document.getElementById("tallyName").value = '';
            }
        });

        onSnapshot(tallyCollection, (snapshot) => {
            const talliesDiv = document.getElementById("tallies");
            talliesDiv.innerHTML = '';
            snapshot.forEach((doc) => {
                const tally = doc.data();
                const tallyDiv = document.createElement("div");
                tallyDiv.className = "flex justify-between items-center p-2 border rounded";
                tallyDiv.style.backgroundColor = tally.color;

                const nameDiv = document.createElement("div");
                nameDiv.className = "font-bold";
                nameDiv.textContent = tally.name;

                const countDiv = document.createElement("div");
                countDiv.className = "text-xl";
                countDiv.textContent = tally.count;

                const incrementButton = document.createElement("button");
                incrementButton.className = "bg-green-500 text-white px-2 py-1 rounded";
                incrementButton.textContent = "+";
                incrementButton.addEventListener("click", async () => {
                    await updateDoc(doc(db, "tallies", doc.id), {
                        count: tally.count + 1
                    });
                });

                const decrementButton = document.createElement("button");
                decrementButton.className = "bg-red-500 text-white px-2 py-1 rounded ml-2";
                decrementButton.textContent = "-";
                decrementButton.addEventListener("click", async () => {
                    if (confirm("Are you sure you want to decrease the count?")) {
                        await updateDoc(doc(db, "tallies", doc.id), {
                            count: tally.count - 1
                        });
                    }
                });

                tallyDiv.appendChild(nameDiv);
                tallyDiv.appendChild(countDiv);
                tallyDiv.appendChild(incrementButton);
                tallyDiv.appendChild(decrementButton);

                talliesDiv.appendChild(tallyDiv);
            });
        });
    </script>
</body>
</html>
